#!/usr/bin/env bash

kubectl exec web-deployment-584645cfc-wvqtf -- curl -s "http://vault:8200/v1/sys/health?standbyok=true"
kubectl exec web-deployment-584645cfc-wvqtf -- curl --request POST  --data '{"jwt": \""$(cat $JWT_PATH)"\", "role": "webapp"}'  http://vault:8200/v1/auth/kubernetes/login

eyJhbGciOiJSUzI1NiIsImtpZCI6Imh5U3p4dGxZdG9pNTdrSHhRWXZGMzlIUU52NzJOS2VIdDQ1ZXhIcS1mUEUifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNjU5NTEyNDUxLCJpYXQiOjE2Mjc5NzY0NTEsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0IiwicG9kIjp7Im5hbWUiOiJ3ZWItZGVwbG95bWVudC01ODQ2NDVjZmMtd3ZxdGYiLCJ1aWQiOiJjY2RiYzhmNS1lYzVhLTQ1MGItOWJkYi0zZGNiZDkzNmUzZmIifSwic2VydmljZWFjY291bnQiOnsibmFtZSI6ImRlZmF1bHQiLCJ1aWQiOiJlOGI5ZDhlMi1lNmRlLTQyMjQtYTA0MS1hMDUxZmMyYmJlNDAifSwid2FybmFmdGVyIjoxNjI3OTgwMDU4fSwibmJmIjoxNjI3OTc2NDUxLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6ZGVmYXVsdDpkZWZhdWx0In0.WQhNu1rPIFUMmRSgD_DyAPO8bxA1LYd7tppWvpkqXxafWTeBipPl2K1tFGfcdbrkQlyAyW-OIbfB5WwLnuunm0RZXjwSe4z5rYOdE-c80mZI_q4L-ufOTsOt83cJ6t42gJ_UF9I9PNc9_PJjfv6keCf7WdwL1JONJXtLYvhIg9zfiQ5t1WS3Xd13-H4N4tZZAZ9oEiZjbKT9EaMAMhb6kkhL6bOe5JQHYwTyXSuJ91ENVpco52Mq-H8jG78WdGCwwuG53WZSo9ewgADbr_o61lwIFkFroqupIvCteqXM3o2Qd6GtyEzPjLB45cmRL9c0gfKf_ckU3FC4FEHNgflEFA
echo "JWT=\$(cat \$JWT_PATH);\necho \"\$JWT\";\ncurl -s http://vault:8200/v1/sys/health?standbyok=true\ncurl --header \"Content-Type: application/json\" -v --trace-ascii /dev/stdout --request POST --data \"{\\\"jwt\\\": \\\"\$JWT\\\", \\\"role\\\": \\\"webapp\\\"}\" http://vault:8200/v1/auth/kubernetes/login" > t.sh


curl --request POST --data '{"jwt": "eyJhbGciOiJSUzI1NiIsImtpZCI6Imh5U3p4dGxZdG9pNTdrSHhRWXZGMzlIUU52NzJOS2VIdDQ1ZXhIcS1mUEUifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNjU5NjMxMzAzLCJpYXQiOjE2MjgwOTUzMDMsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0IiwicG9kIjp7Im5hbWUiOiJ3ZWItZGVwbG95bWVudC01NTljNjY5N2Y5LWY0Y2xtIiwidWlkIjoiN2QwMTViOWUtZTQwNi00NjE3LTg0NTItNDlmZmI3OTZmNTU2In0sInNlcnZpY2VhY2NvdW50Ijp7Im5hbWUiOiJkZWZhdWx0IiwidWlkIjoiZThiOWQ4ZTItZTZkZS00MjI0LWEwNDEtYTA1MWZjMmJiZTQwIn0sIndhcm5hZnRlciI6MTYyODA5ODkxMH0sIm5iZiI6MTYyODA5NTMwMywic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmRlZmF1bHQ6ZGVmYXVsdCJ9.lBVQ2e2xFrTLCCyCKLrysCcNj76JfBN8Mt_E3KjyXzTGeM2JhE7dm27XjyzFIf5iOwwmlHwy0sEEIN1iYw0m_H0RnFv1IFfhDyudPFPjF96EhoVv-gRlYq4fVkGxWKXj-PtGIhBnvdB4haQsvSyA7GCLjr673ICJjebZ5pyROwtQMwUuougRNYo5xMN4fLzvMs1Ci9rlPWFW_0e-s2VVsF1z3TuZeMxnT0Q_42hS_ETtjxI882fVmroKUqaaihxwrXcDkJJzudi-vaK9Nx32FnCliAmfvV1lW6BVt66d2P2XZap8JikkNs5f13brlhdGxqcgiCMwJj7YFFG97MUM2w", "role": "webapp"}' http://vault:8200/v1/auth/kubernetes/logi 